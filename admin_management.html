<!DOCTYPE html>

<html lang="ko">

<head>

Â  Â  <meta charset="UTF-8">

Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">

Â  Â  <title>ì£¼ë¬¸ ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ</title>

Â  Â  <script src="https://cdn.tailwindcss.com"></script>

Â  Â  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

Â  Â  <!-- ì—‘ì…€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€ -->

Â  Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

Â  Â  <style>

Â  Â  Â  Â  body { font-family: 'Inter', sans-serif; }

Â  Â  Â  Â  .tab-btn { transition: all 0.2s ease-in-out; }

Â  Â  Â  Â  .tab-btn.view-active { background-color: #4f46e5; color: white; }

Â  Â  Â  Â  @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

Â  Â  Â  Â  .summary-card, .order-card { animation: fadeIn 0.5s ease-in-out; }



Â  Â  Â  Â  /* ì‹ ê·œ/ì¶”ê°€ ì£¼ë¬¸ ì•Œë¦¼ í…Œë‘ë¦¬ */

Â  Â  Â  Â  .highlight-new-order {

Â  Â  Â  Â  Â  Â  border-width: 4px;

Â  Â  Â  Â  Â  Â  border-color: #ef4444; /* red-500 */

Â  Â  Â  Â  }

Â  Â  </style>

</head>

<body class="bg-gray-100">



Â  Â  <!-- ì‚¬ìš´ë“œ ì¬ìƒì„ ìœ„í•œ ìˆ¨ê²¨ì§„ ì˜¤ë””ì˜¤ ìš”ì†Œ -->

Â  Â  <!-- ì¤‘ìš”: ì•„ë˜ src ê²½ë¡œëŠ” ì‹¤ì œ ìŒì› íŒŒì¼ì´ ì—…ë¡œë“œëœ URLë¡œ ë³€ê²½í•´ì•¼ í•©ë‹ˆë‹¤. -->

Â  Â  <!-- ì˜ˆ: https://your-github-username.github.io/your-repo/sounds/new-order.mp3 -->

Â  Â  <audio id="new-order-sound" src="YOUR_NEW_ORDER_SOUND_URL_HERE" preload="auto"></audio>

Â  Â  <audio id="additional-order-sound" src="YOUR_ADDITIONAL_ORDER_SOUND_URL_HERE" preload="auto"></audio>



Â  Â  <div class="container mx-auto p-4 sm:p-6 lg:p-8">

Â  Â  Â  Â  <header class="text-center my-6 relative">

Â  Â  Â  Â  Â  Â  <h1 class="text-4xl font-bold text-gray-800">ì£¼ë¬¸ ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ</h1>

Â  Â  Â  Â  Â  Â  <p class="text-gray-600 mt-2">ì¼ìë¥¼ ì„ íƒí•´ ì£¼ë¬¸ì„ ê´€ë¦¬í•˜ê³ , ìƒˆ ì¼ì°¨ë¥¼ ì‹œì‘í•˜ì„¸ìš”.</p>

Â  Â  Â  Â  Â  Â  <button id="sound-toggle-btn" class="absolute top-0 right-0 p-2 rounded-full hover:bg-gray-200 transition">

Â  Â  Â  Â  Â  Â  Â  Â  <!-- ì•„ì´ì½˜ì€ ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ë™ì ìœ¼ë¡œ ì„¤ì • -->

Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  </header>



Â  Â  Â  Â  <div id="day-tabs-container" class="mb-6 flex items-center justify-center flex-wrap gap-3"></div>

Â  Â  Â  Â  <section id="summary-section" class="mb-8 grid grid-cols-1 md:grid-cols-2 gap-6"></section>

Â  Â  Â  Â  <main id="order-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"></main>

Â  Â  </div>



Â  Â  <!-- Modals -->

Â  Â  <div id="modal-container" class="hidden fixed inset-0 z-50"></div>



Â  Â  <script type="module">

Â  Â  Â  Â  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";

Â  Â  Â  Â  import { getFirestore, collection, query, where, onSnapshot, doc, updateDoc, deleteDoc, orderBy, getDocs, setDoc, writeBatch, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";



Â  Â  Â  Â  const firebaseConfig = {
    apiKey: "AIzaSyAMS_URZ1lFsbyJscsIjPvgENZouSbnX0A",
    authDomain: "order-cfe51.firebaseapp.com",
    projectId: "order-cfe51",
    storageBucket: "order-cfe51.appspot.com",
    messagingSenderId: "1047726700523",
    appId: "1:1047726700523:web:0360158e7baca0d3450bae",
    measurementId: "G-45K52YE0BB"
};

Â  Â  Â  Â Â 

Â  Â  Â  Â  if (!firebaseConfig.projectId || firebaseConfig.projectId === "YOUR_PROJECT_ID") {

Â  Â  Â  Â  Â  Â  document.body.innerHTML = `<div class="min-h-screen bg-gray-100 flex items-center justify-center p-4">

Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-8 text-center bg-white border-4 border-dashed border-red-300 rounded-lg shadow-lg max-w-2xl">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h1 class="text-3xl font-bold mb-4 text-red-600">Firebase ì„¤ì • ì˜¤ë¥˜</h1>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="mb-4 text-gray-700">ì´ ì•±ì„ ì‚¬ìš©í•˜ë ¤ë©´ Firebase ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="mb-6 text-gray-700">ì•„ë˜ ë‹¨ê³„ì— ë”°ë¼ ì½”ë“œì˜ <code class="bg-red-100 text-red-800 p-1 rounded font-mono">firebaseConfig</code> ë³€ìˆ˜ë¥¼ ë³¸ì¸ì˜ í”„ë¡œì íŠ¸ ê°’ìœ¼ë¡œ êµì²´í•´ì£¼ì„¸ìš”.</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ol class="text-left mx-auto space-y-3 text-gray-600 list-decimal list-inside">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li><a href="https://console.firebase.google.com/" target="_blank" class="text-blue-600 underline font-semibold">Firebase ì½˜ì†”</a>ì— ì ‘ì†í•˜ì—¬ í”„ë¡œì íŠ¸ë¥¼ ì„ íƒí•˜ì„¸ìš”.</li>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>í”„ë¡œì íŠ¸ ì„¤ì •(<svg xmlns="http://www.w3.org/2000/svg" class="inline-block h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.532 1.532 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.532 1.532 0 01-.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" /></svg> ì•„ì´ì½˜) &gt; <span class="font-semibold">ì¼ë°˜</span> íƒ­ìœ¼ë¡œ ì´ë™í•˜ì„¸ìš”.</li>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>'ë‚´ ì•±' ì„¹ì…˜ì—ì„œ 'SDK ì„¤ì • ë° êµ¬ì„±' ì•„ë˜ì˜ <span class="font-semibold">'êµ¬ì„±'</span>ì„ ì„ íƒí•˜ì„¸ìš”.</li>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>ë³´ì´ëŠ” <code class="bg-gray-200 p-1 rounded font-mono">const firebaseConfig = { ... };</code> ì½”ë“œë¥¼ ë³µì‚¬í•˜ì—¬ ì´ íŒŒì¼ì˜ ì½”ë“œì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.</li>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </ol>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  </div>`;

Â  Â  Â  Â  Â  Â  throw new Error("Firebase configuration is missing.");

Â  Â  Â  Â  }

Â  Â  Â  Â Â 

Â  Â  Â  Â  const app = initializeApp(firebaseConfig);

Â  Â  Â  Â  const db = getFirestore(app);



Â  Â  Â  Â  const DELETE_PASSWORD = "11531153";



Â  Â  Â  Â  let allOrders = [];

Â  Â  Â  Â  let config = { dayTabs: [], activeDay: null };

Â  Â  Â  Â  let viewingDay = 'all';

Â  Â  Â  Â  let previousOrdersMap = new Map();

Â  Â  Â  Â  let isMuted = false;

Â  Â  Â  Â Â 

Â  Â  Â  Â  const configRef = doc(db, "festivalConfig", "settings");

Â  Â  Â  Â  const dayTabsContainer = document.getElementById('day-tabs-container');

Â  Â  Â  Â  const summarySection = document.getElementById('summary-section');

Â  Â  Â  Â  const orderList = document.getElementById('order-list');

Â  Â  Â  Â  const modalContainer = document.getElementById('modal-container');

Â  Â  Â  Â  const soundToggleBtn = document.getElementById('sound-toggle-btn');

Â  Â  Â  Â  const newOrderAudio = document.getElementById('new-order-sound');

Â  Â  Â  Â  const additionalOrderAudio = document.getElementById('additional-order-sound');

Â  Â  Â  Â Â 

Â  Â  Â  Â  const soundOnIcon = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" /></svg>`;

Â  Â  Â  Â  const soundOffIcon = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 14l-2-2m0 0l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`;



Â  Â  Â  Â  function toggleSound() {

Â  Â  Â  Â  Â  Â  isMuted = !isMuted;

Â  Â  Â  Â  Â  Â  soundToggleBtn.innerHTML = isMuted ? soundOffIcon : soundOnIcon;

Â  Â  Â  Â  }

Â  Â  Â  Â  soundToggleBtn.innerHTML = soundOnIcon;

Â  Â  Â  Â  soundToggleBtn.addEventListener('click', toggleSound);



Â  Â  Â  Â  const formatTimestamp = (ts, includeDate = false) => {

Â  Â  Â  Â  Â  Â  if (!ts) return '';

Â  Â  Â  Â  Â  Â  const options = includeDate ? { year: 'numeric', month: '2-digit', day: '2-digit', weekday: 'short', hour: '2-digit', minute: '2-digit' } : { hour: '2-digit', minute: '2-digit' };

Â  Â  Â  Â  Â  Â  return new Date(ts.seconds * 1000).toLocaleString('ko-KR', options);

Â  Â  Â  Â  };



Â  Â  Â  Â  function renderDashboard() {

Â  Â  Â  Â  Â  Â  const isTotalView = viewingDay === 'all';

Â  Â  Â  Â  Â  Â  const ordersToDisplay = isTotalView ? allOrders : allOrders.filter(order => order.festivalDay === viewingDay);

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  let totalRevenue = 0;

Â  Â  Â  Â  Â  Â  const menuSales = {};

Â  Â  Â  Â  Â  Â  ordersToDisplay.forEach(order => { totalRevenue += order.totalPrice; });



Â  Â  Â  Â  Â  Â  const allItems = ordersToDisplay.flatMap(order => order.orderBatches.flatMap(batch => batch.items));

Â  Â  Â  Â  Â  Â  allItems.forEach(item => { menuSales[item.name] = (menuSales[item.name] || 0) + item.quantity; });





Â  Â  Â  Â  Â  Â  summarySection.innerHTML = `

Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-white p-6 rounded-xl shadow-lg summary-card">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-xl font-bold text-gray-700 mb-2">${isTotalView ? 'ì „ì²´ ì´ ë§¤ì¶œ' : 'ì¼ì¼ ì´ ë§¤ì¶œ'}</h2>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-4xl font-extrabold text-indigo-600">${totalRevenue.toLocaleString()}ì›</p>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-white p-6 rounded-xl shadow-lg summary-card">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-xl font-bold text-gray-700 mb-2">${isTotalView ? 'ì „ì²´ ë©”ë‰´ë³„ íŒë§¤ëŸ‰' : 'ì¼ì¼ ë©”ë‰´ë³„ íŒë§¤ëŸ‰'}</h2>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-2 text-gray-800">${Object.keys(menuSales).length > 0 ? Object.entries(menuSales).sort(([,a],[,b]) => b-a).map(([name, q]) => `<p class="flex justify-between font-medium"><span>${name}</span><span>${q}ê°œ</span></p>`).join('') : '<p class="text-gray-500">í•´ë‹¹ ì¼ì°¨ì˜ ì£¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>'}</div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>`;



Â  Â  Â  Â  Â  Â  orderList.innerHTML = '';

Â  Â  Â  Â  Â  Â  const statusPriority = { "ì£¼ë¬¸ ì ‘ìˆ˜ ì¤‘": 1, "ìš”ë¦¬ ì¤‘": 2, "ì„œë¹™ ì™„ë£Œ": 3, "ì²˜ë¦¬ ì™„ë£Œ": 4 };

Â  Â  Â  Â  Â  Â  ordersToDisplay.sort((a, b) => (statusPriority[a.status] || 99) - (statusPriority[b.status] || 99));

Â  Â  Â  Â  Â  Â  ordersToDisplay.forEach(order => {

Â  Â  Â  Â  Â  Â  Â  Â  const cardWrapper = document.createElement('div');

Â  Â  Â  Â  Â  Â  Â  Â  cardWrapper.innerHTML = createOrderCardHTML(order).trim();

Â  Â  Â  Â  Â  Â  Â  Â  orderList.appendChild(cardWrapper.firstChild);

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  }

Â  Â  Â  Â Â 

Â  Â  Â  Â  function createOrderCardHTML(order) {

Â  Â  Â  Â  Â  Â  const statusStyles = { "ì£¼ë¬¸ ì ‘ìˆ˜ ì¤‘": "border-yellow-400", "ìš”ë¦¬ ì¤‘": "border-blue-400", "ì„œë¹™ ì™„ë£Œ": "border-green-400", "ì²˜ë¦¬ ì™„ë£Œ": "border-gray-300" };

Â  Â  Â  Â  Â  Â  const statusBtnStyles = { "ì£¼ë¬¸ ì ‘ìˆ˜ ì¤‘": "bg-yellow-100 text-yellow-800", "ìš”ë¦¬ ì¤‘": "bg-blue-100 text-blue-800", "ì„œë¹™ ì™„ë£Œ": "bg-green-100 text-green-800", "ì²˜ë¦¬ ì™„ë£Œ": "bg-gray-200 text-gray-500" };

Â  Â  Â  Â  Â  Â  const highlightClass = order.isHighlighted ? 'highlight-new-order' : (statusStyles[order.status] || '');



Â  Â  Â  Â  Â  Â  const batchesHTML = (order.orderBatches || []).map((batch, index) => {

Â  Â  Â  Â  Â  Â  Â  Â  const itemsHTML = batch.items.map(item => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const textColor = !batch.acknowledged ? 'text-red-500 font-bold' : 'text-gray-700';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return `<p class="flex justify-between ${textColor}"><span>${item.name}</span><span>x${item.quantity}</span></p>`;

Â  Â  Â  Â  Â  Â  Â  Â  }).join('');

Â  Â  Â  Â  Â  Â  Â  Â  const separator = index > 0 ? '<hr class="my-2 border-dashed border-gray-400">' : '';

Â  Â  Â  Â  Â  Â  Â  Â  return separator + itemsHTML;

Â  Â  Â  Â  Â  Â  }).join('');



Â  Â  Â  Â  Â  Â  return `

Â  Â  Â  Â  Â  Â  <div data-order-id="${order.id}" class="bg-white rounded-xl shadow-lg p-5 flex flex-col transition-all duration-300 relative order-card border-4 ${highlightClass} ${order.status === 'ì²˜ë¦¬ ì™„ë£Œ' ? 'opacity-60' : ''}">

Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-between items-start mb-3">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold text-indigo-600 pr-4">í…Œì´ë¸” <span class="table-number">${order.tableNumber}</span></h2>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-right flex-shrink-0">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button data-action="showDeleteModal" data-id="${order.id}" class="text-gray-400 hover:text-red-600 z-10 block ml-auto w-6 h-6"><svg class="pointer-events-none" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg></button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="order-time text-xs text-gray-500 block mt-1">${formatTimestamp(order.timestamp, true)}</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="order-items border-t border-b border-gray-200 py-3 my-3 space-y-2 text-gray-700 flex-grow">${batchesHTML}</div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-right mb-4"><span class="text-lg font-semibold">ì´ ê¸ˆì•¡:</span><span class="total-price text-xl font-bold text-gray-900">${order.totalPrice.toLocaleString()}ì›</span></div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="status-btn-group grid grid-cols-2 gap-2 text-sm">${Object.keys(statusBtnStyles).map(status => `<button data-action="updateStatus" data-id="${order.id}" data-status="${status}" class="p-2 rounded-md font-semibold ${status === order.status ? statusBtnStyles[status] : 'bg-gray-200 hover:bg-gray-300'}">${status}</button>`).join('')}</div>

Â  Â  Â  Â  Â  Â  </div>`;

Â  Â  Â  Â  }



Â  Â  Â  Â  function renderTabs() {

Â  Â  Â  Â  Â  Â  const validTabs = config.dayTabs.filter(d => d && typeof d.day === 'number');

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  const tabsHTML = validTabs.sort((a, b) => a.day - b.day).map(dayInfo => {

Â  Â  Â  Â  Â  Â  Â  Â  return `

Â  Â  Â  Â  Â  Â  Â  Â  <div class="relative group">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button data-day="${dayInfo.day}" class="tab-btn px-4 py-2 rounded-md font-semibold text-sm bg-white shadow w-full text-left ${dayInfo.day === viewingDay ? 'view-active' : ''}">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${dayInfo.day}ì¼ì°¨

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="absolute top-full pt-1 left-1/2 -translate-x-1/2 z-20 opacity-0 group-hover:opacity-100 pointer-events-none group-hover:pointer-events-auto transition-opacity duration-300">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center bg-white shadow-xl rounded-md p-1">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button data-action="activateDay" data-day="${dayInfo.day}" title="í™œì„±í™”" class="p-2 text-gray-500 hover:text-emerald-500">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 pointer-events-none" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button data-action="showDateModal" data-day="${dayInfo.day}" title="ë‚ ì§œ ìˆ˜ì •" class="p-2 text-gray-500 hover:text-indigo-600">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 pointer-events-none" viewBox="0 0 20 20" fill="currentColor"><path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" /><path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" /></svg>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button data-action="showPasswordModal" data-day="${dayInfo.day}" title="ì‚­ì œ" class="p-2 text-gray-500 hover:text-red-600">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 pointer-events-none" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd" /></svg>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${dayInfo.day === config.activeDay ? '<span class="absolute -top-2 -right-2 text-xs bg-emerald-500 text-white px-1.5 py-0.5 rounded-full animate-pulse">ON</span>' : ''}

Â  Â  Â  Â  Â  Â  Â  Â  </div>`;

Â  Â  Â  Â  Â  Â  }).join('');



Â  Â  Â  Â  Â  Â  const totalTabHTML = `<div class="relative"><button data-day="all" class="tab-btn px-4 py-2 rounded-md font-semibold text-sm bg-white shadow ${viewingDay === 'all' ? 'view-active' : ''}">ğŸ“Š ì „ì²´</button></div>`;

Â  Â  Â  Â  Â  Â  const addDayBtnHTML = `<button id="add-day-btn" class="px-3 py-2 bg-green-500 text-white rounded-md font-bold text-sm hover:bg-green-600 shadow">+</button>`;

Â  Â  Â  Â  Â  Â  const exportBtnHTML = `<button id="export-btn" class="px-4 py-2 bg-gray-700 text-white rounded-md font-semibold text-sm hover:bg-gray-800 shadow">ì—‘ì…€ ë‚´ë³´ë‚´ê¸°</button>`;



Â  Â  Â  Â  Â  Â  dayTabsContainer.innerHTML = totalTabHTML + tabsHTML + addDayBtnHTML + exportBtnHTML;

Â  Â  Â  Â  }



Â  Â  Â  Â  function showModal(innerHTML) {

Â  Â  Â  Â  Â  Â  modalContainer.innerHTML = `<div class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4">${innerHTML}</div>`;

Â  Â  Â  Â  Â  Â  modalContainer.classList.remove('hidden');

Â  Â  Â  Â  }

Â  Â  Â  Â  function hideModal() {

Â  Â  Â  Â  Â  Â  modalContainer.classList.add('hidden');

Â  Â  Â  Â  Â  Â  modalContainer.innerHTML = '';

Â  Â  Â  Â  }



Â  Â  Â  Â  const appFunctions = {

Â  Â  Â  Â  Â  Â  showDateModal: (day) => {

Â  Â  Â  Â  Â  Â  Â  Â  const dayInfo = config.dayTabs.find(d => d.day === day);

Â  Â  Â  Â  Â  Â  Â  Â  showModal(`

Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-white p-8 rounded-xl shadow-2xl text-center w-full max-w-sm">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-xl font-bold text-gray-800 mb-4">${day}ì¼ì°¨ ë‚ ì§œ ì„¤ì •</h2>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input id="date-input" type="date" value="${dayInfo.date || ''}" class="w-full p-2 border rounded-md mb-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-center space-x-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button data-action="hideModal" class="px-6 py-2 bg-gray-300 rounded-lg">ì·¨ì†Œ</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="save-date-btn" class="px-6 py-2 bg-indigo-600 text-white rounded-lg">ì €ì¥</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>`);

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('save-date-btn').onclick = () => appFunctions.saveDate(day);

Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  saveDate: async (day) => {

Â  Â  Â  Â  Â  Â  Â  Â  const newDate = document.getElementById('date-input').value;

Â  Â  Â  Â  Â  Â  Â  Â  if (!newDate) { alert('ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.'); return; }

Â  Â  Â  Â  Â  Â  Â  Â  const updatedDayTabs = config.dayTabs.map(d => d.day === day ? { ...d, date: newDate } : d);

Â  Â  Â  Â  Â  Â  Â  Â  await setDoc(configRef, { dayTabs: updatedDayTabs }, { merge: true });

Â  Â  Â  Â  Â  Â  Â  Â  hideModal();

Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  activateDay: async (day) => {

Â  Â  Â  Â  Â  Â  Â  Â  const dayInfo = config.dayTabs.find(d => d.day === day);

Â  Â  Â  Â  Â  Â  Â  Â  if (!dayInfo || !dayInfo.date) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert('ë‚ ì§œê°€ ì„¤ì •ë˜ì§€ ì•Šì€ ì¼ì°¨ëŠ” í™œì„±í™”í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ë‚ ì§œë¥¼ ì €ì¥í•´ì£¼ì„¸ìš”.');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  if (confirm(`${day}ì¼ì°¨(${dayInfo.date})ë¥¼ ì£¼ë¬¸ ìˆ˜ì§‘ì¼ë¡œ í™œì„±í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await setDoc(configRef, { activeDay: day }, { merge: true });

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  showPasswordModal: (day) => {

Â  Â  Â  Â  Â  Â  Â  Â  showModal(`

Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-white p-8 rounded-xl shadow-2xl text-center w-full max-w-sm">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-xl font-bold text-red-600 mb-4">${day}ì¼ì°¨ ì‚­ì œ</h2>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-gray-600 mb-4">ì‚­ì œí•˜ë ¤ë©´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”. í•´ë‹¹ ì¼ì°¨ì˜ ëª¨ë“  ì£¼ë¬¸ ë‚´ì—­ì´ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤.</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input id="password-input" type="password" class="w-full p-2 border rounded-md mb-4" placeholder="ë¹„ë°€ë²ˆí˜¸">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-center space-x-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button data-action="hideModal" class="px-6 py-2 bg-gray-300 rounded-lg">ì·¨ì†Œ</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="confirm-delete-day-btn" class="px-6 py-2 bg-red-600 text-white rounded-lg">ì‚­ì œ í™•ì¸</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>`);

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('confirm-delete-day-btn').onclick = () => appFunctions.confirmDeleteDay(day);

Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  confirmDeleteDay: async (dayToDelete) => {

Â  Â  Â  Â  Â  Â  Â  Â  const password = document.getElementById('password-input').value;

Â  Â  Â  Â  Â  Â  Â  Â  if (password !== DELETE_PASSWORD) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  if (!confirm(`ì •ë§ë¡œ ${dayToDelete}ì¼ì°¨ì˜ ëª¨ë“  ë°ì´í„°ë¥¼ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) return;



Â  Â  Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const batch = writeBatch(db);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const ordersToDeleteQuery = query(collection(db, "orders"), where("festivalDay", "==", dayToDelete));

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const ordersToDeleteSnapshot = await getDocs(ordersToDeleteQuery);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ordersToDeleteSnapshot.forEach(doc => batch.delete(doc.ref));



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const remainingTabsSorted = config.dayTabs.filter(d => d.day !== dayToDelete).sort((a, b) => a.day - b.day);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const renumberMap = new Map();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const renumberedTabs = remainingTabsSorted.map((tab, index) => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const newDay = index + 1;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (tab.day !== newDay) renumberMap.set(tab.day, newDay);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return { ...tab, day: newDay };

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  for (const [oldDay, newDay] of renumberMap.entries()) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const ordersToUpdateQuery = query(collection(db, "orders"), where("festivalDay", "==", oldDay));

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const ordersToUpdateSnapshot = await getDocs(ordersToUpdateQuery);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ordersToUpdateSnapshot.forEach(doc => batch.update(doc.ref, { festivalDay: newDay }));

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let newActiveDay = config.activeDay;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (config.activeDay === dayToDelete) newActiveDay = renumberedTabs.length > 0 ? Math.max(...renumberedTabs.map(d => d.day)) : null;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else if (renumberMap.has(config.activeDay)) newActiveDay = renumberMap.get(config.activeDay);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (viewingDay === dayToDelete || renumberMap.has(viewingDay)) viewingDay = newActiveDay || 'all';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  batch.set(configRef, { dayTabs: renumberedTabs, activeDay: newActiveDay });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await batch.commit();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hideModal();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert(`${dayToDelete}ì¼ì°¨ ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);

Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("ì¼ì°¨ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert("ë°ì´í„° ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  showDeleteModal: (orderId) => {

Â  Â  Â  Â  Â  Â  Â  Â  showModal(`<div class="bg-white p-8 rounded-xl shadow-2xl text-center w-full max-w-sm"><h2 class="text-xl font-bold text-red-600 mb-4">ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</h2><p class="text-gray-700 mb-6">ì´ ì£¼ë¬¸ ë‚´ì—­ì€ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤.</p><div class="flex justify-center space-x-4"><button data-action="hideModal" class="px-6 py-2 bg-gray-300 rounded-lg">ì·¨ì†Œ</button><button id="confirm-delete-btn" class="px-6 py-2 bg-red-600 text-white rounded-lg">ì‚­ì œ</button></div></div>`);

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('confirm-delete-btn').onclick = () => appFunctions.confirmDelete(orderId);

Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  confirmDelete: async (orderId) => { await deleteDoc(doc(db, "orders", orderId)); hideModal(); },

Â  Â  Â  Â  Â  Â  updateStatus: async (orderId, status) => {

Â  Â  Â  Â  Â  Â  Â  Â  const orderRef = doc(db, "orders", orderId);

Â  Â  Â  Â  Â  Â  Â  Â  const orderSnap = await getDoc(orderRef);

Â  Â  Â  Â  Â  Â  Â  Â  if(orderSnap.exists()) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const updatedBatches = orderSnap.data().orderBatches.map(batch => ({ ...batch, acknowledged: true }));

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await updateDoc(orderRef, {Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  status: status,Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isHighlighted: false,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  orderBatches: updatedBatchesÂ 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  showExportModal: () => {

Â  Â  Â  Â  Â  Â  Â  Â  const isTotalView = viewingDay === 'all';

Â  Â  Â  Â  Â  Â  Â  Â  const dailyDisabled = isTotalView ? 'disabled' : '';

Â  Â  Â  Â  Â  Â  Â  Â  const dailyLabelClass = isTotalView ? 'text-gray-400 cursor-not-allowed' : 'cursor-pointer';

Â  Â  Â  Â  Â  Â  Â  Â  showModal(`

Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-white p-8 rounded-xl shadow-2xl text-left w-full max-w-sm">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-xl font-bold text-gray-800 mb-6">ì—‘ì…€ë¡œ ë‚´ë³´ë‚¼ ë°ì´í„° ì„ íƒ</h2>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="flex items-center ${dailyLabelClass}"><input type="checkbox" id="export-daily-sales" class="h-5 w-5" ${dailyDisabled}><span class="ml-3 text-gray-700">ì¼ì¼ ë§¤ì¶œëŸ‰ (${isTotalView ? 'ì¼ì°¨ ì„ íƒ í•„ìš”' : viewingDay + 'ì¼ì°¨'})</span></label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="flex items-center cursor-pointer"><input type="checkbox" id="export-total-sales" class="h-5 w-5"><span class="ml-3 text-gray-700">ì „ì²´ ë§¤ì¶œëŸ‰</span></label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="flex items-center cursor-pointer"><input type="checkbox" id="export-orders" class="h-5 w-5"><span class="ml-3 text-gray-700">ì£¼ë¬¸ ë‚´ì—­ (${isTotalView ? 'ì „ì²´' : viewingDay + 'ì¼ì°¨'})</span></label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="mt-8 flex justify-end space-x-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button data-action="hideModal" class="px-6 py-2 bg-gray-300 rounded-lg">ì·¨ì†Œ</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="confirm-export-btn" class="px-6 py-2 bg-green-600 text-white rounded-lg">ë‹¤ìš´ë¡œë“œ</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>`);

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('confirm-export-btn').onclick = appFunctions.exportToExcel;

Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  exportToExcel: () => {

Â  Â  Â  Â  Â  Â  Â  Â  const wb = XLSX.utils.book_new();

Â  Â  Â  Â  Â  Â  Â  Â  let sheetsAdded = 0;



Â  Â  Â  Â  Â  Â  Â  Â  if (document.getElementById('export-daily-sales')?.checked) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const dailyOrders = allOrders.filter(order => order.festivalDay === viewingDay);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { totalRevenue, menuSales } = calculateSales(dailyOrders);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const ws = XLSX.utils.aoa_to_sheet([['í•­ëª©', 'ìˆ˜ëŸ‰/ê¸ˆì•¡'], ['ì´ ë§¤ì¶œ', totalRevenue], ...Object.entries(menuSales)]);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  XLSX.utils.book_append_sheet(wb, ws, `${viewingDay}ì¼ì°¨ ë§¤ì¶œ`);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sheetsAdded++;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  if (document.getElementById('export-total-sales')?.checked) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { totalRevenue, menuSales } = calculateSales(allOrders);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const ws = XLSX.utils.aoa_to_sheet([['í•­ëª©', 'ìˆ˜ëŸ‰/ê¸ˆì•¡'], ['ì´ ë§¤ì¶œ', totalRevenue], ...Object.entries(menuSales)]);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  XLSX.utils.book_append_sheet(wb, ws, 'ì „ì²´ ë§¤ì¶œ');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sheetsAdded++;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  if (document.getElementById('export-orders')?.checked) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isTotalView = viewingDay === 'all';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const ordersToExport = isTotalView ? allOrders : allOrders.filter(order => order.festivalDay === viewingDay);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const data = ordersToExport.map(order => ({'ì£¼ë¬¸ì‹œê°„': formatTimestamp(order.timestamp, true),'ì¼ì°¨': order.festivalDay,'í…Œì´ë¸”': order.tableNumber,'ë©”ë‰´': order.orderBatches.flatMap(b => b.items).map(item => `${item.name} x${item.quantity}`).join(', '),'ì´ê¸ˆì•¡': order.totalPrice,'ìƒíƒœ': order.status}));

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const ws = XLSX.utils.json_to_sheet(data);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  XLSX.utils.book_append_sheet(wb, ws, `${isTotalView ? 'ì „ì²´' : viewingDay + 'ì¼ì°¨'} ì£¼ë¬¸ë‚´ì—­`);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sheetsAdded++;

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  if (sheetsAdded > 0) XLSX.writeFile(wb, `festival_data_${new Date().toISOString().split('T')[0]}.xlsx`);

Â  Â  Â  Â  Â  Â  Â  Â  else alert('ë‚´ë³´ë‚¼ í•­ëª©ì„ í•˜ë‚˜ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”.');

Â  Â  Â  Â  Â  Â  Â  Â  hideModal();

Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  hideModal: hideModal

Â  Â  Â  Â  };

Â  Â  Â  Â Â 

Â  Â  Â  Â  function calculateSales(orders) {

Â  Â  Â  Â  Â  Â  let totalRevenue = 0;

Â  Â  Â  Â  Â  Â  const menuSales = {};

Â  Â  Â  Â  Â  Â  const allItems = orders.flatMap(order => order.orderBatches.flatMap(batch => batch.items));

Â  Â  Â  Â  Â  Â  allItems.forEach(item => {

Â  Â  Â  Â  Â  Â  Â  Â  menuSales[item.name] = (menuSales[item.name] || 0) + item.quantity;

Â  Â  Â  Â  Â  Â  Â  Â  totalRevenue += item.price * item.quantity;

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  return { totalRevenue, menuSales };

Â  Â  Â  Â  }



Â  Â  Â  Â  document.body.addEventListener('click', e => {

Â  Â  Â  Â  Â  Â  let target = e.target;

Â  Â  Â  Â  Â  Â  while(target && !target.dataset.action && target.id !== 'add-day-btn' && target.id !== 'export-btn' && !target.matches('.tab-btn')) {

Â  Â  Â  Â  Â  Â  Â  Â  target = target.parentElement;

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  if(!target) return;



Â  Â  Â  Â  Â  Â  const action = target.dataset.action;

Â  Â  Â  Â  Â  Â  if (action && appFunctions[action]) {

Â  Â  Â  Â  Â  Â  Â  Â  const day = target.dataset.day ? parseInt(target.dataset.day) : null;

Â  Â  Â  Â  Â  Â  Â  Â  const id = target.dataset.id;

Â  Â  Â  Â  Â  Â  Â  Â  const status = target.dataset.status;

Â  Â  Â  Â  Â  Â  Â  Â  if (day !== null && !isNaN(day)) appFunctions[action](day);

Â  Â  Â  Â  Â  Â  Â  Â  else if (id && status) appFunctions[action](id, status);

Â  Â  Â  Â  Â  Â  Â  Â  else if (id) appFunctions[action](id);

Â  Â  Â  Â  Â  Â  Â  Â  else appFunctions[action]();

Â  Â  Â  Â  Â  Â  } else if (target.id === 'add-day-btn') {

Â  Â  Â  Â  Â  Â  Â  Â  const dayNumbers = config.dayTabs.map(d => d.day).filter(d => !isNaN(d));

Â  Â  Â  Â  Â  Â  Â  Â  const nextDay = dayNumbers.length > 0 ? Math.max(0, ...dayNumbers) + 1 : 1;

Â  Â  Â  Â  Â  Â  Â  Â  setDoc(configRef, { dayTabs: [...config.dayTabs, { day: nextDay, date: null }] }, { merge: true });

Â  Â  Â  Â  Â  Â  } else if (target.id === 'export-btn') {

Â  Â  Â  Â  Â  Â  Â  Â  appFunctions.showExportModal();

Â  Â  Â  Â  Â  Â  } else if (target.matches('.tab-btn')) {

Â  Â  Â  Â  Â  Â  Â  Â  Â const day = target.dataset.day;

Â  Â  Â  Â  Â  Â  Â  Â  Â viewingDay = day === 'all' ? 'all' : parseInt(day);

Â  Â  Â  Â  Â  Â  Â  Â  Â renderTabs();

Â  Â  Â  Â  Â  Â  Â  Â  Â renderDashboard();

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  });



Â  Â  Â  Â  onSnapshot(configRef, async (docSnap) => {

Â  Â  Â  Â  Â  Â  if (docSnap.exists()) {

Â  Â  Â  Â  Â  Â  Â  Â  const newConfig = { dayTabs: [], activeDay: 1, ...docSnap.data() };

Â  Â  Â  Â  Â  Â  Â  Â  const validTabs = newConfig.dayTabs.filter(d => d && typeof d.day === 'number');

Â  Â  Â  Â  Â  Â  Â  Â  if(validTabs.length !== newConfig.dayTabs.length) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.warn("ì˜ëª»ëœ íƒ­ ë°ì´í„°ë¥¼ ê°ì§€í•˜ì—¬ ì •ë¦¬í•©ë‹ˆë‹¤.");

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  newConfig.dayTabs = validTabs;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await setDoc(configRef, { dayTabs: validTabs }, { merge: true });

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  config = newConfig;

Â  Â  Â  Â  Â  Â  Â  Â  if (viewingDay === null || (viewingDay !== 'all' && !config.dayTabs.some(d => d.day === viewingDay))) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  viewingDay = config.activeDay || (config.dayTabs.length > 0 ? Math.max(...config.dayTabs.map(d => d.day)) : 'all');

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  const initialConfig = { dayTabs: [{day: 1, date: new Date().toISOString().split('T')[0]}], activeDay: 1 };

Â  Â  Â  Â  Â  Â  Â  Â  await setDoc(configRef, initialConfig);

Â  Â  Â  Â  Â  Â  Â  Â  config = initialConfig;

Â  Â  Â  Â  Â  Â  Â  Â  viewingDay = 1;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  renderTabs();

Â  Â  Â  Â  Â  Â  renderDashboard();

Â  Â  Â  Â  });



Â  Â  Â  Â  onSnapshot(query(collection(db, "orders"), orderBy("timestamp", "desc")), (snapshot) => {

Â  Â  Â  Â  Â  Â  const newOrdersMap = new Map();

Â  Â  Â  Â  Â  Â  snapshot.docs.forEach(doc => newOrdersMap.set(doc.id, { id: doc.id, ...doc.data() }));



Â  Â  Â  Â  Â  Â  if (previousOrdersMap.size > 0 && !isMuted) {

Â  Â  Â  Â  Â  Â  Â  Â  newOrdersMap.forEach((order, id) => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const prevOrder = previousOrdersMap.get(id);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!prevOrder && order.isHighlighted) { // ì‹ ê·œ ì£¼ë¬¸

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  newOrderAudio.play().catch(e => console.log("ì‚¬ìš´ë“œ ì¬ìƒ ì˜¤ë¥˜:", e));

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (prevOrder && !prevOrder.isHighlighted && order.isHighlighted) { // ì¶”ê°€ ì£¼ë¬¸

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  additionalOrderAudio.play().catch(e => console.log("ì‚¬ìš´ë“œ ì¬ìƒ ì˜¤ë¥˜:", e));

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  allOrders = Array.from(newOrdersMap.values());

Â  Â  Â  Â  Â  Â  previousOrdersMap = new Map(newOrdersMap);

Â  Â  Â  Â  Â  Â  renderDashboard();

Â  Â  Â  Â  });

Â  Â  </script>

</body>

</html>
